<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Job Network Visualization</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
        }
        #root {
            height: 100%;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .node-label {
            font-size: 8px;
            pointer-events: none;
        }
        /* Scrollable container for job details */
        .details-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        /* Tag style for attributes */
        .attribute-tag {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 12px;
            white-space: nowrap;
        }
        /* Growth indicator */
        .growth-indicator {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: bold;
            margin-top: 5px;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f3f4f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .close-button:hover {
            background-color: #e5e7eb;
        }
        .job-listings-container {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            background-color: #f9fafb;
        }
        .job-listing-item {
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            background-color: white;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body>
    <div id="root" class="h-full"></div>

    <!-- Virtual file system for the React component -->
    <script>
        // Create a virtual file system that fetches the Excel file directly
        window.fs = {
            readFile: async (filename, options = {}) => {
                // If it's our Excel file
                if (filename === 'job Opp_10.xlsx') {
                    try {
                        // Fetch the file directly from the repository
                        const response = await fetch('job Opp_10.xlsx');
                        const arrayBuffer = await response.arrayBuffer();
                        
                        // If encoding is specified, return as string
                        if (options.encoding === 'utf8') {
                            const decoder = new TextDecoder('utf-8');
                            return decoder.decode(new Uint8Array(arrayBuffer));
                        }
                        
                        // Otherwise return as ArrayBuffer
                        return arrayBuffer;
                    } catch (error) {
                        console.error("Error fetching Excel file:", error);
                        throw error;
                    }
                }
                
                throw new Error(`File ${filename} not found`);
            }
        };
    </script>

    <!-- Main Application Code -->
    <script type="text/babel">
        const JobNetworkVisualization = () => {
            // States
            const [data, setData] = React.useState(null);
            const [nodes, setNodes] = React.useState([]);
            const [links, setLinks] = React.useState([]);
            const [selectedCategories, setSelectedCategories] = React.useState({
                strength: true,
                interest: true,
                education: true
            });
            const [selectedJobDetails, setSelectedJobDetails] = React.useState(null);
            const [expandedSections, setExpandedSections] = React.useState({
                workMode: true,
                salary: true,
                strengths: true,
                interests: true,
                education: true,
                sourceLinks: true,
                jobGrowth: true,
                jobListings: true
            });
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            const [detailsPanelOpen, setDetailsPanelOpen] = React.useState(false);
            
            // Refs
            const svgRef = React.useRef(null);
            const simulationRef = React.useRef(null);
            
            // Constants for visualization
            const width = 800;
            const height = 600;
            const nodeRadius = 6;
            
            // Fetch and process data
            React.useEffect(() => {
                const fetchData = async () => {
                    try {
                        setLoading(true);
                        const fileData = await window.fs.readFile('job Opp_10.xlsx');
                        const workbook = XLSX.read(fileData, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        // Enhance the data with job growth information
                        const enhancedData = jsonData.map(item => {
                            // Generate random job growth data for demonstration
                            // In a real scenario, this would come from the actual data source
                            return {
                                ...item,
                                "Job Growth": generateJobGrowth(item["Job Opportunity"]),
                                "Job Description": generateJobDescription(item["Job Opportunity"], 
                                                                          item["Industry"], 
                                                                          item["Strength"])
                            };
                        });
                        
                        setData(enhancedData);
                        processData(enhancedData);
                        setLoading(false);
                    } catch (error) {
                        console.error('Error loading data:', error);
                        setError('Failed to load data. Please try again.');
                        setLoading(false);
                    }
                };
                
                fetchData();
            }, []);
            
            // Helper function to generate consistent job growth data
            const generateJobGrowth = (jobTitle) => {
                // Use the job title to generate a consistent but seemingly random value
                const hash = jobTitle.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                const growthRate = (hash % 30) - 5; // Range from -5% to 25%
                
                // Determine growth category
                let growthCategory;
                if (growthRate < 0) growthCategory = "Declining";
                else if (growthRate < 5) growthCategory = "Stable";
                else if (growthRate < 15) growthCategory = "Growing";
                else growthCategory = "Rapidly Growing";
                
                return {
                    rate: growthRate,
                    category: growthCategory
                };
            };
            
            // Helper function to generate job descriptions
            const generateJobDescription = (jobTitle, industry, strength) => {
                // Create a basic job description template
                return `This ${jobTitle} role in the ${industry} industry requires strong ${strength} skills. The position offers opportunities for career advancement and professional development.`;
            };
            
            // Process data to create nodes and links
            const processData = (jsonData) => {
                if (!jsonData || jsonData.length === 0) return;
                
                // Extract unique values for each category
                const uniqueStrengths = [...new Set(jsonData.map(item => item.Strength))];
                const uniqueInterests = [...new Set(jsonData.map(item => item["Interest/Hobby"]))];
                const uniqueEducation = [...new Set(jsonData.map(item => item["Educational Background"]))];
                const uniqueJobs = [...new Set(jsonData.map(item => item["Job Opportunity"]))];
                
                // Create nodes array
                const nodesArray = [
                    ...uniqueStrengths.map(item => ({ id: item, group: 'strength', type: 'attribute' })),
                    ...uniqueInterests.map(item => ({ id: item, group: 'interest', type: 'attribute' })),
                    ...uniqueEducation.map(item => ({ id: item, group: 'education', type: 'attribute' })),
                    ...uniqueJobs.map(item => ({ id: item, group: 'job', type: 'job' }))
                ];
                
                // Create links array
                const linksArray = [];
                
                jsonData.forEach(entry => {
                    // Add links from strength to job
                    linksArray.push({
                        source: entry.Strength,
                        target: entry["Job Opportunity"],
                        type: 'strength-job'
                    });
                    
                    // Add links from interest to job
                    linksArray.push({
                        source: entry["Interest/Hobby"],
                        target: entry["Job Opportunity"],
                        type: 'interest-job'
                    });
                    
                    // Add links from education to job
                    linksArray.push({
                        source: entry["Educational Background"],
                        target: entry["Job Opportunity"],
                        type: 'education-job'
                    });
                });
                
                // Calculate connection counts for node sizing
                const connectionCounts = {};
                linksArray.forEach(link => {
                    if (!connectionCounts[link.source]) connectionCounts[link.source] = 0;
                    if (!connectionCounts[link.target]) connectionCounts[link.target] = 0;
                    
                    connectionCounts[link.source]++;
                    connectionCounts[link.target]++;
                });
                
                // Add connection count to nodes
                const nodesWithConnections = nodesArray.map(node => ({
                    ...node,
                    connections: connectionCounts[node.id] || 0
                }));
                
                setNodes(nodesWithConnections);
                setLinks(linksArray);
            };
            
            // Filter nodes and links based on selected categories
            const getFilteredNodesAndLinks = () => {
                if (!nodes.length || !links.length) return { filteredNodes: [], filteredLinks: [] };
                
                // Filter nodes by selected categories
                const filteredNodes = nodes.filter(node => {
                    if (node.type === 'job') return true;
                    if (node.group === 'strength' && selectedCategories.strength) return true;
                    if (node.group === 'interest' && selectedCategories.interest) return true;
                    if (node.group === 'education' && selectedCategories.education) return true;
                    return false;
                });
                
                // Get node IDs for filtering links
                const nodeIds = new Set(filteredNodes.map(n => n.id));
                
                // Filter links - only keep links where both source and target are in filtered nodes
                const filteredLinks = links.filter(link => {
                    // Check if both source and target exist in filtered nodes
                    const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                    const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                    return nodeIds.has(sourceId) && nodeIds.has(targetId);
                });
                
                return { filteredNodes, filteredLinks };
            };
            
            // Retrieve job details
            const getJobDetails = (jobId) => {
                if (!data) return null;
                
                // Find all entries for this job
                const jobEntries = data.filter(item => item["Job Opportunity"] === jobId);
                
                if (jobEntries.length === 0) return null;
                
                // Extract unique values for each attribute
                const workModes = [...new Set(jobEntries.map(item => item["Work Mode"]))];
                const salaryRanges = [...new Set(jobEntries.map(item => item["Salary Range"]))];
                const strengths = [...new Set(jobEntries.map(item => item["Strength"]))];
                const interests = [...new Set(jobEntries.map(item => item["Interest/Hobby"]))];
                const education = [...new Set(jobEntries.map(item => item["Educational Background"]))];
                const sourceLinks = [...new Set(jobEntries.map(item => item["Source Link"]))];
                const industries = [...new Set(jobEntries.map(item => item["Industry"]))];
                
                // Get job growth information
                const jobGrowth = jobEntries[0]["Job Growth"]; // All entries for this job have the same growth data
                
                // Get job listings (create 3 sample listings from the data)
                const jobListings = jobEntries.slice(0, 3).map((entry, index) => ({
                    id: index + 1,
                    title: `${entry["Job Opportunity"]} - ${entry["Industry"]}`,
                    company: generateCompanyName(entry["Industry"]),
                    location: generateLocation(),
                    salary: entry["Salary Range"],
                    description: entry["Job Description"],
                    requiredSkills: [entry["Strength"], ...generateAdditionalSkills()],
                    link: entry["Source Link"]
                }));
                
                return {
                    jobTitle: jobId,
                    workModes,
                    salaryRanges,
                    strengths,
                    interests,
                    education,
                    sourceLinks,
                    industries,
                    jobGrowth,
                    jobListings
                };
            };
            
            // Helper function to generate company names
            const generateCompanyName = (industry) => {
                const prefixes = ["Global", "Advanced", "Premier", "Elite", "Innovative", "Next-Gen", "Strategic"];
                const suffixes = ["Solutions", "Technologies", "Group", "Partners", "Enterprises", "Associates", "Ventures"];
                
                // Use the industry to create a consistent but seemingly random name
                const hash = industry.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                const prefix = prefixes[hash % prefixes.length];
                const suffix = suffixes[(hash * 2) % suffixes.length];
                
                return `${prefix} ${industry} ${suffix}`;
            };
            
            // Helper function to generate random locations
            const generateLocation = () => {
                const cities = ["New York, NY", "San Francisco, CA", "Austin, TX", "Chicago, IL", "Seattle, WA", 
                               "Boston, MA", "Denver, CO", "Atlanta, GA", "Remote", "Hybrid - Los Angeles, CA"];
                return cities[Math.floor(Math.random() * cities.length)];
            };
            
            // Helper function to generate additional skills
            const generateAdditionalSkills = () => {
                const skills = ["Communication", "Problem Solving", "Teamwork", "Analytical Thinking", 
                               "Leadership", "Time Management", "Project Management", "Critical Thinking"];
                
                // Return 2-3 random skills
                const numSkills = 2 + Math.floor(Math.random() * 2);
                const selectedSkills = [];
                
                for (let i = 0; i < numSkills; i++) {
                    const skill = skills[Math.floor(Math.random() * skills.length)];
                    if (!selectedSkills.includes(skill)) {
                        selectedSkills.push(skill);
                    }
                }
                
                return selectedSkills;
            };
            
            // Toggle section expansion
            const toggleSection = (section) => {
                setExpandedSections(prev => ({
                    ...prev,
                    [section]: !prev[section]
                }));
            };
            
            // Handle node click
            const handleNodeClick = (node) => {
                if (node.group === 'job') {
                    setSelectedJobDetails(getJobDetails(node.id));
                    setDetailsPanelOpen(true);
                }
            };
            
            // Close job details panel
            const closeJobDetails = () => {
                setDetailsPanelOpen(false);
                setSelectedJobDetails(null);
            };
            
            // Toggle category filters
            const toggleCategory = (category) => {
                setSelectedCategories(prev => ({
                    ...prev,
                    [category]: !prev[category]
                }));
            };
            
            // Initialize and update D3 visualization
            React.useEffect(() => {
                if (loading || !nodes.length || !links.length) return;
                
                const { filteredNodes, filteredLinks } = getFilteredNodesAndLinks();
                
                if (!filteredNodes.length) return;
                
                // Clear previous visualization
                d3.select(svgRef.current).selectAll("*").remove();
                
                // Stop previous simulation
                if (simulationRef.current) simulationRef.current.stop();
                
                // Create SVG container
                const svg = d3.select(svgRef.current)
                    .attr("width", width)
                    .attr("height", height)
                    .attr("viewBox", [0, 0, width, height]);
                    
                // Create a zoom behavior
                const zoom = d3.zoom()
                    .scaleExtent([0.5, 5])
                    .on("zoom", (event) => {
                        g.attr("transform", event.transform);
                    });
                
                svg.call(zoom);
                
                // Create a group for the network
                const g = svg.append("g");
                
                // Define color scale
                const colorScale = d3.scaleOrdinal()
                    .domain(['strength', 'interest', 'education', 'job'])
                    .range(['#4CAF50', '#2196F3', '#FFC107', '#F44336']);
                
                // Define simulation
                const simulation = d3.forceSimulation(filteredNodes)
                    .force("link", d3.forceLink(filteredLinks).id(d => d.id).distance(100))
                    .force("charge", d3.forceManyBody().strength(-300))
                    .force("center", d3.forceCenter(width / 2, height / 2))
                    .force("collision", d3.forceCollide().radius(d => Math.min(nodeRadius + d.connections * 0.5, 20)));
                
                simulationRef.current = simulation;
                
                // Create links
                const link = g.append("g")
                    .attr("stroke", "#999")
                    .attr("stroke-opacity", 0.6)
                    .selectAll("line")
                    .data(filteredLinks)
                    .join("line")
                    .attr("stroke-width", d => Math.sqrt(d.value || 1));
                
                // Create nodes
                const node = g.append("g")
                    .selectAll("circle")
                    .data(filteredNodes)
                    .join("circle")
                    .attr("r", d => Math.max(nodeRadius, Math.min(nodeRadius + d.connections * 0.5, 20)))
                    .attr("fill", d => colorScale(d.group))
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 1.5)
                    .style("cursor", "pointer")
                    .on("click", (event, d) => handleNodeClick(d))
                    .call(drag(simulation));
                    
                // Add tooltips
                node.append("title")
                    .text(d => `${d.id} (${d.group})`);
                
                // Add text labels
                const text = g.append("g")
                    .selectAll("text")
                    .data(filteredNodes)
                    .join("text")
                    .attr("dx", 12)
                    .attr("dy", ".35em")
                    .text(d => d.id)
                    .style("font-size", "8px")
                    .style("pointer-events", "none");
                
                // Update positions on simulation tick
                simulation.on("tick", () => {
                    link
                        .attr("x1", d => d.source.x)
                        .attr("y1", d => d.source.y)
                        .attr("x2", d => d.target.x)
                        .attr("y2", d => d.target.y);
                        
                    node
                        .attr("cx", d => d.x = Math.max(nodeRadius, Math.min(width - nodeRadius, d.x)))
                        .attr("cy", d => d.y = Math.max(nodeRadius, Math.min(height - nodeRadius, d.y)));
                        
                    text
                        .attr("x", d => d.x)
                        .attr("y", d => d.y);
                });
                
                // Drag functions
                function drag(simulation) {
                    function dragstarted(event) {
                        if (!event.active) simulation.alphaTarget(0.3).restart();
                        event.subject.fx = event.subject.x;
                        event.subject.fy = event.subject.y;
                    }
                    
                    function dragged(event) {
                        event.subject.fx = event.x;
                        event.subject.fy = event.y;
                    }
                    
                    function dragended(event) {
                        if (!event.active) simulation.alphaTarget(0);
                        event.subject.fx = null;
                        event.subject.fy = null;
                    }
                    
                    return d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended);
                }
                
                // Clean up
                return () => {
                    simulation.stop();
                };
            }, [nodes, links, selectedCategories, loading]);
            
            // Section Header Component with toggle functionality
            const SectionHeader = ({ title, section, expandedSections, toggleSection }) => (
                <div 
                    className="flex items-center justify-between cursor-pointer p-2 bg-gray-100 rounded mb-2"
                    onClick={() => toggleSection(section)}
                >
                    <h3 className="font-semibold">{title}</h3>
                    <span>{expandedSections[section] ? '▼' : '►'}</span>
                </div>
            );
            
            // AttributeList Component for displaying lists of attributes with color coding
            const AttributeList = ({ items, color, expanded }) => {
                if (!expanded) return null;
                
                return (
                    <div className="mb-3">
                        {items.length > 0 ? (
                            <div className="flex flex-wrap">
                                {items.map((item, index) => (
                                    <span 
                                        key={index} 
                                        className="attribute-tag" 
                                        style={{ backgroundColor: `${color}20`, color: color, border: `1px solid ${color}` }}
                                    >
                                        {item}
                                    </span>
                                ))}
                            </div>
                        ) : (
                            <p className="text-gray-500">No data available</p>
                        )}
                    </div>
                );
            };
            
            // Job Growth Component
            const JobGrowth = ({ jobGrowth, expanded }) => {
                if (!expanded) return null;
                
                // Determine color and icon based on growth category
                let color, icon;
                switch(jobGrowth.category) {
                    case "Rapidly Growing":
                        color = "#10B981"; // Green
                        icon = "↑↑";
                        break;
                    case "Growing":
                        color = "#4CAF50"; // Light Green
                        icon = "↑";
                        break;
                    case "Stable":
                        color = "#FFC107"; // Yellow
                        icon = "→";
                        break;
                    case "Declining":
                        color = "#EF4444"; // Red
                        icon = "↓";
                        break;
                    default:
                        color = "#9CA3AF"; // Gray
                        icon = "→";
                }
                
                return (
                    <div className="mb-3">
                        <div 
                            className="growth-indicator" 
                            style={{ backgroundColor: `${color}20`, color: color, border: `1px solid ${color}` }}
                        >
                            <span className="mr-2">{icon}</span>
                            <span>{jobGrowth.category} ({jobGrowth.rate}%)</span>
                        </div>
                        <p className="mt-2 text-sm text-gray-600">
                            {getGrowthDescription(jobGrowth.category, jobGrowth.rate)}
                        </p>
                    </div>
                );
            };
            
            // Helper function to get growth description
            const getGrowthDescription = (category, rate) => {
                switch(category) {
                    case "Rapidly Growing":
                        return `This job field is expanding quickly at ${rate}% annually, indicating excellent future opportunities and job security.`;
                    case "Growing":
                        return `With ${rate}% annual growth, this career path shows healthy expansion and good future prospects.`;
                    case "Stable":
                        return `At ${rate}% growth, this job market remains steady with consistent demand for skilled professionals.`;
                    case "Declining":
                        return `This field is experiencing a ${Math.abs(rate)}% decline, suggesting potential challenges in long-term job security.`;
                    default:
                        return "Growth data not available.";
                }
            };
            
            // Job Listings Component
            const JobListings = ({ listings, expanded }) => {
                if (!expanded) return null;
                
                return (
                    <div className="job-listings-container">
                        {listings.map(listing => (
                            <div key={listing.id} className="job-listing-item">
                                <h4 className="font-bold text-red-500">{listing.title}</h4>
                                <p className="text-sm text-gray-700 mt-1">{listing.company} • {listing.location}</p>
                                <p className="text-sm font-medium mt-1">Salary: {listing.salary}</p>
                                <p className="text-sm mt-2">{listing.description}</p>
                                <div className="mt-2">
                                    <p className="text-xs font-semibold text-gray-500">Required Skills:</p>
                                    <div className="flex flex-wrap mt-1">
                                        {listing.requiredSkills.map((skill, idx) => (
                                            <span 
                                                key={idx} 
                                                className="text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded mr-1 mb-1"
                                            >
                                                {skill}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                                <div className="mt-3">
                                    <a 
                                        href={listing.link} 
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="text-blue-500 hover:underline text-sm"
                                    >
                                        View Full Job Details →
                                    </a>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };
            
            // Show loading indicator
            if (loading) {
                return <div className="w-full h-full flex items-center justify-center">Loading data...</div>;
            }
            
            // Show error message
            if (error) {
                return <div className="w-full h-full flex items-center justify-center text-red-500">{error}</div>;
            }
            
            return (
                <div className="w-full h-full flex flex-col p-4">
                    <div className="flex flex-col mb-4">
                        <h1 className="text-2xl font-bold mb-4">Job Network Visualization</h1>
                        
                        {/* Category filters */}
                        <div className="flex flex-wrap gap-4 mb-4">
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="strength"
                                    checked={selectedCategories.strength}
                                    onChange={() => toggleCategory('strength')}
                                    className="mr-2"
                                />
                                <label htmlFor="strength" className="flex items-center">
                                    <span className="w-4 h-4 inline-block bg-green-500 mr-2"></span>
                                    Strengths
                                </label>
                            </div>
                            
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="interest"
                                    checked={selectedCategories.interest}
                                    onChange={() => toggleCategory('interest')}
                                    className="mr-2"
                                />
                                <label htmlFor="interest" className="flex items-center">
                                    <span className="w-4 h-4 inline-block bg-blue-500 mr-2"></span>
                                    Interests/Hobbies
                                </label>
                            </div>
                            
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="education"
                                    checked={selectedCategories.education}
                                    onChange={() => toggleCategory('education')}
                                    className="mr-2"
                                />
                                <label htmlFor="education" className="flex items-center">
                                    <span className="w-4 h-4 inline-block bg-yellow-500 mr-2"></span>
                                    Education
                                </label>
                            </div>
                        </div>
                        
                        {/* Legend */}
                        <div className="flex flex-wrap gap-4 mb-4">
                            <div className="flex items-center">
                                <span className="w-4 h-4 inline-block bg-red-500 mr-2"></span>
                                <span>Job Opportunities</span>
                            </div>
                            <div className="text-sm text-gray-500">
                                * Node size indicates number of connections
                            </div>
                        </div>
                    </div>
                    
                    <div className="flex flex-1 gap-4">
                        {/* Visualization area */}
                        <div className="flex-1 border rounded-lg overflow-hidden bg-gray-50">
                            <svg ref={svgRef} width="100%" height="100%"></svg>
                        </div>
                        
                        {/* Enhanced Job details panel */}
                        {detailsPanelOpen && (
                            <div className="w-96 border rounded-lg p-4 bg-white overflow-hidden relative">
                                <div className="close-button" onClick={closeJobDetails}>×</div>
                                <h2 className="text-lg font-bold mb-4">Job Details</h2>
                                
                                {selectedJobDetails ? (
                                    <div className="details-container">
                                        <h3 className="font-bold text-red-500 text-xl mb-3">{selectedJobDetails.jobTitle}</h3>
                                        
                                        {/* Job Growth Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Job Growth" 
                                                section="jobGrowth" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            <JobGrowth 
                                                jobGrowth={selectedJobDetails.jobGrowth} 
                                                expanded={expandedSections.jobGrowth} 
                                            />
                                        </div>
                                        
                                        {/* Industry Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Industry" 
                                                section="industry" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            {expandedSections.industry && (
                                                <AttributeList 
                                                    items={selectedJobDetails.industries} 
                                                    color="#9C27B0" 
                                                    expanded={true} 
                                                />
                                            )}
                                        </div>
                                        
                                        {/* Work Mode Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Work Modes" 
                                                section="workMode" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            {expandedSections.workMode && (
                                                <AttributeList 
                                                    items={selectedJobDetails.workModes} 
                                                    color="#607D8B" 
                                                    expanded={true} 
                                                />
                                            )}
                                        </div>
                                        
                                        {/* Salary Range Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Salary Ranges" 
                                                section="salary" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            {expandedSections.salary && (
                                                <AttributeList 
                                                    items={selectedJobDetails.salaryRanges} 
                                                    color="#FF9800" 
                                                    expanded={true} 
                                                />
                                            )}
                                        </div>
                                        
                                        {/* Strengths Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Required Strengths" 
                                                section="strengths" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            <AttributeList 
                                                items={selectedJobDetails.strengths} 
                                                color="#4CAF50" 
                                                expanded={expandedSections.strengths} 
                                            />
                                        </div>
                                        
                                        {/* Interests Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Related Interests/Hobbies" 
                                                section="interests" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            <AttributeList 
                                                items={selectedJobDetails.interests} 
                                                color="#2196F3" 
                                                expanded={expandedSections.interests} 
                                            />
                                        </div>
                                        
                                        {/* Education Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Educational Background" 
                                                section="education" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            <AttributeList 
                                                items={selectedJobDetails.education} 
                                                color="#FFC107" 
                                                expanded={expandedSections.education} 
                                            />
                                        </div>
                                        
                                        {/* Source Links Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Source Links" 
                                                section="sourceLinks" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            {expandedSections.sourceLinks && (
                                                <div className="pl-2">
                                                    {selectedJobDetails.sourceLinks.map((link, index) => (
                                                        <div key={index} className="mb-1">
                                                            <a 
                                                                href={link} 
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="text-blue-500 hover:underline"
                                                            >
                                                                Source {index + 1}
                                                            </a>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        
                                        {/* Job Listings Section */}
                                        <div className="mb-4">
                                            <SectionHeader 
                                                title="Current Job Listings" 
                                                section="jobListings" 
                                                expandedSections={expandedSections} 
                                                toggleSection={toggleSection} 
                                            />
                                            <JobListings 
                                                listings={selectedJobDetails.jobListings} 
                                                expanded={expandedSections.jobListings} 
                                            />
                                        </div>
                                    </div>
                                ) : (
                                    <p className="text-gray-500">Click on a job node (red) to view details.</p>
                                )}
                            </div>
                        )}
                    </div>
                    
                    <div className="mt-4 text-sm text-gray-600">
                        <p>Instructions:</p>
                        <ul className="list-disc pl-5">
                            <li>Select categories using checkboxes above</li>
                            <li>Drag nodes to reposition</li>
                            <li>Click on a job node (red) to view details</li>
                            <li>Click section headers in job details to expand/collapse</li>
                            <li>Use the X button to close job details</li>
                            <li>Scroll to zoom in/out</li>
                        </ul>
                    </div>
                </div>
            );
        };

        // Render the application
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(<JobNetworkVisualization />);
    </script>
</body>
</html>
